version: '3'

services:
    ci:
        build: ./ci
        volumes:
            - ./ci/tests:/tests
        tty: true
        working_dir: /tests
        hostname: ci
        networks:
            cluster:

    node1:
        build:
            context: .
            args:
                # from env
                - DOCKER_GROUP_ID
        ports:
            #- "5001:2375"
            - "8501:8500"
            - "81:80"
        volumes:
            - /mnt/btrfs1:/var/lib/buttervolume
            - ./..:/node
        privileged: true
        tty: true
        working_dir: /node
        hostname: node1
        networks:
            cluster:
                # eth0
                ipv4_address: 10.10.77.61

    node2:
        build:
            context: .
            args:
                # from env
                - DOCKER_GROUP_ID
        ports:
            #- "5002:2375"
            - "8502:8500"
            - "82:80"
        volumes:
            - /mnt/btrfs2:/var/lib/buttervolume
            - ./..:/node
        privileged: true
        tty: true
        working_dir: /node
        hostname: node2
        networks:
            cluster:
                # eth0
                ipv4_address: 10.10.77.62

    node3:
        build:
            context: .
            args:
                # from env
                - DOCKER_GROUP_ID
        ports:
            #- "5003:2375"
            - "8503:8500"
            - "83:80"
        volumes:
            - /mnt/btrfs3:/var/lib/buttervolume
            - ./..:/node
        privileged: true
        tty: true
        working_dir: /node
        hostname: node3
        networks:
            cluster:
                # eth0
                ipv4_address: 10.10.77.63

    node4:
        build:
            context: .
            args:
                # from env
                - DOCKER_GROUP_ID
        ports:
            #- "5004:2375"
            - "8504:8500"
            - "84:80"
        volumes:
            - /mnt/btrfs4:/var/lib/buttervolume
            - ./..:/node
        privileged: true
        tty: true
        working_dir: /node
        hostname: node4
        networks:
            cluster:
                # eth0
                ipv4_address: 10.10.77.64

networks:
    cluster:
        ipam:
            config:
                - subnet: 10.10.77.0/24
